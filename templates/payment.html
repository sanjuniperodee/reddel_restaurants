<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://widget.cloudpayments.ru/bundles/cloudpayments.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>

</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>

<script src="https://widget.cloudpayments.ru/bundles/cloudpayments.js"></script>
<script>
    window.onload = this.pay = function () {
 var widget = new cp.CloudPayments();
    widget.pay('charge', // или 'charge'
        { //options
            publicId: 'pk_c786b702701d63eecaace715da930', //id из личного кабинета
            description: 'Оплата товаров в example.com', //назначение
            amount: parseInt({{ amount }}), //сумма
            currency: 'KZT', //валюта
            accountId: 'user@example.com', //идентификатор плательщика (необязательно)
            invoiceId: '1234567', //номер заказа  (необязательно)
            email: 'user@example.com', //email плательщика (необязательно)
            skin: "mini", //дизайн виджета (необязательно)
            autoClose: 3, //время в секундах до авто-закрытия виджета (необязательный)
            data: {
                myProp: 'myProp value'
            },
            configuration: {
                common: {
                    successRedirectUrl: "https://{ваш сайт}/success", // адреса для перенаправления
                    failRedirectUrl: "https://{ваш сайт}/fail"        // при оплате по Tinkoff Pay
                }
            },
            payer: {
                firstName: 'Тест',
                lastName: 'Тестов',
                middleName: 'Тестович',
                birth: '1955-02-24',
                address: 'тестовый проезд дом тест',
                street: 'Lenina',
                city: 'MO',
                country: 'RU',
                phone: '123',
                postcode: '345'
            }
        },
        {
            onSuccess: function (options) {
                console.log("SUCCESSSSSSSS!!!!!!!!!!!!!!!!1")
                const data = {
                  paid: "1",
                  amount: '{{ amount }}',
                  key: "{{ key }}",
                  transaction_id: "{{ transaction_id }}",
                  shop_id: "{{ shop_id }}",
                  signature : "signature"
                };
                const md5Hash = CryptoJS.MD5(`${data.shop_id};${data.amount};${data.transaction_id};${data.key};${data.paid};a9aada9a6aff1b8558672aeb2daa0390`);
                const signature = md5Hash.toString(CryptoJS.enc.Hex);
                data.signature=signature
                console.log(data)
                const url = 'https://adl-i.kz/payments/external/5933393/success?paid=1';
                {#console.log(url + "&amount=" + data.amount + "&key=" + data.key + "&transaction_id=" + data.transaction_id + "&signature=" + data.signature + "&shop_id=" + data.shop_id)#}
                window.location.href = url + "&amount=" + data.amount + "&key=" + data.key + "&transaction_id=" + data.transaction_id + "&signature=" + data.signature + "&shop_id=" + data.shop_id
                {#fetch('https://adl-i.kz/payments/external/5933393/success', {#}
                {#      method: 'POST',#}
                {#      body: JSON.stringify({#}
                {#          data#}
                {#      })#}
                {#    })#}
                {#    .then(response => response.json())#}
                {#    .then(result => {#}
                {#      console.log(result);#}
                {#    })#}
                {#    .catch(error => {#}
                {#      console.error('Ошибка:', error);#}
                {#    });#}
                    console.log("SUCCESSSSSSSS!!!!!!!!!!!!!!!!1")
                },
            onFail: function (reason, options) {
                console.log("FAILFAILFAILFAILFALIFALIF")
            },
            onComplete: function (paymentResult, options) { //Вызывается как только виджет получает от api.cloudpayments ответ с результатом транзакции.
                //например вызов вашей аналитики
            }
        }
    )
};
</script>
<script type="text/javascript" >
const overlay = document.createElement('div');
overlay.id = 'loader';
overlay.style.cssText = `
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.7);
    z-index: 999;
`;

const svgImage = document.createElement('img');
svgImage.id = 'svgImage';
svgImage.src = 'https://storage.googleapis.com/flutterflow-io-6f20.appspot.com/projects/hi-test-jv4537/assets/1mll1osxyim7/Logo-4-%5Bremix%5D_(1).gif';
svgImage.style.cssText = `
    max-width: 100%;
    max-height: 100%;
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
`;
svgImage.style.display = 'none';

document.body.appendChild(overlay);
document.body.appendChild(svgImage);
function hideOverlay() {
    overlay.style.display = 'none';
    svgImage.style.display = 'block';
}
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(hideOverlay, 100); // Replace with your actual loading code.
});
window.addEventListener('load', hideOverlay);
</script>
</body>

</html>